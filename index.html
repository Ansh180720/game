<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<title>Monster Shooter — Mobile Friendly</title>
<meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no" />
<style>
  html,body{
    height:100%; margin:0; background:#111; font-family:Arial; color:#fff;
    display:flex; justify-content:center; align-items:center;
    min-height:100vh;
  }
  #phone{
    width:360px; max-width:98vw;
    height:720px; max-height:98vh;
    background:#000; border-radius:18px;
    position:relative; overflow:hidden;
    box-shadow:0 0 30px #000;
    display:flex; flex-direction:column;
  }
  #gameArea{
    flex:1;
    display:flex; justify-content:center; align-items:center;
    position:relative;
    background:#000;
  }
  canvas{
    background:#000;
    width:100%; max-width:100%;
    height:100%; max-height:100%;
    display:block;
  }
  #controls{
    height:180px; min-height:120px;
    width:100%; background:transparent;
    display:flex; justify-content:space-between; align-items:flex-end;
    position:relative; padding:10px; box-sizing:border-box;
  }
  #fireBtn{
    width:90px; height:90px; background:#ff3333; border-radius:999px;
    display:flex; align-items:center; justify-content:center;
    font-size:20px; font-weight:bold; user-select:none;
    border:3px solid rgba(255,255,255,0.2);
    touch-action:none;
  }
  .moveBtn{
    width:80px; height:80px;
    background:#222; border-radius:16px; border:3px solid #555;
    display:flex; align-items:center; justify-content:center;
    font-size:32px; user-select:none;
    touch-action:none;
  }
  #move{
    display:flex; flex-direction:column; align-items:center; gap:6px;
  }
  #leftRight{
    display:flex; gap:6px;
  }
  .overlay{
    position:absolute; inset:0; background:#000a; z-index:20;
    display:flex; flex-direction:column; justify-content:center;
    align-items:center;
  }
  .btn{
    padding:16px 28px; background:#007aff; border-radius:12px;
    font-size:20px; cursor:pointer; margin-top:20px;
  }
  #highScore{
    position:absolute; top:8px; right:18px; z-index:25;
    padding:8px 12px;
    background:#222b; color:#ffeb3b;
    font-weight:bold; font-size:21px; border-radius:10px;
    pointer-events:none;
    font-family:Arial,sans-serif;
  }
</style>
</head>
<body>
<div id="phone">
  <div id="gameArea">
    <div id="highScore">High Score: 0</div>
    <canvas id="game" width="600" height="700"></canvas>
  </div>
  <div id="startScreen" class="overlay">
    <h2>MONSTER SHOOTER</h2>
    <div id="startBtn" class="btn">START</div>
  </div>
  <div id="retryScreen" class="overlay" style="display:none">
    <h2>GAME OVER</h2>
    <div id="retryBtn" class="btn">RETRY</div>
  </div>
  <div id="controls">
    <div id="fireBtn">FIRE</div>
    <div id="move">
      <div id="up" class="moveBtn">▲</div>
      <div id="leftRight">
        <div id="left" class="moveBtn">◀</div>
        <div id="right" class="moveBtn">▶</div>
      </div>
      <div id="down" class="moveBtn">▼</div>
    </div>
  </div>
</div>
<script>
const W = 600, H = 700;
function fitCanvas() {
  let phone = document.getElementById('phone');
  let gameArea = document.getElementById('gameArea');
  let canvas = document.getElementById('game');
  let areaW = gameArea.clientWidth, areaH = gameArea.clientHeight;
  let scale = Math.min(areaW / W, areaH / H);
  canvas.style.width  = (W*scale) + 'px';
  canvas.style.height = (H*scale) + 'px';
}
window.addEventListener('resize', fitCanvas);
window.addEventListener('orientationchange', fitCanvas);
setTimeout(fitCanvas,50); // Slightly earlier resize for low-end phones

const SCORE_KEY = 'monsterShooterHighScore';
function getHighScore() {
  return parseInt(localStorage.getItem(SCORE_KEY) || '0', 10);
}
function setHighScore(val) {
  localStorage.setItem(SCORE_KEY, val+'');
}
function showHighScore(val) {
  document.getElementById('highScore').textContent = 'High Score: ' + val;
}
showHighScore(getHighScore());

let gameStarted = false;
let lastFrame = performance.now();

(() => {
  const canvas = document.getElementById('game');
  const ctx = canvas.getContext('2d');
  const HERO_SIZE = 40, HERO_X = 250, HERO_Y = 500;
  const BASE_HERO_SPEED = 320;   // px/sec
  const BASE_MONSTER_SPEED = 120; // px/sec
  const BASE_SPAWN_RATE = 50;     // lower = more frequent
  const BULLET_SPEED = 500;       // px/sec
  let heroX, heroY, bullets, monsters, score, gameOver, monsterSpeed, spawnRate, heroSpeed;
  window.moveLeft=false;
  window.moveRight=false;
  window.moveUp=false;
  window.moveDown=false;
  window.mouseHeld=false;

  function reset(){
    heroX=HERO_X; heroY=HERO_Y;
    bullets=[]; monsters=[];
    score=0; gameOver=false;
    monsterSpeed=BASE_MONSTER_SPEED;
    spawnRate=BASE_SPAWN_RATE;
    heroSpeed=BASE_HERO_SPEED;
    lastFrame = performance.now();
  }
  window.globalReset = reset;

  function intersect(a,b){
    return !(a.x+a.w<b.x || b.x+b.w<a.x || a.y+a.h<b.y || b.y+b.h<a.y);
  }
  window.globalGameOver = ()=>{
    gameOver=true;
    document.getElementById("retryScreen").style.display="flex";
  };

  function draw(){
    ctx.clearRect(0,0,W,H);
    ctx.fillStyle="#000"; ctx.fillRect(0,0,W,H);
    ctx.fillStyle="#0ff"; ctx.fillRect(heroX,heroY,HERO_SIZE,HERO_SIZE);
    ctx.fillStyle="#ff0";
    bullets.forEach(b=>ctx.fillRect(b.x,b.y,b.w,b.h));
    ctx.fillStyle="#f44";
    monsters.forEach(m=>ctx.fillRect(m.x,m.y,m.w,m.h));
    ctx.fillStyle="#fff"; ctx.font="22px Arial";
    ctx.fillText("Score: "+score,20,40);
  }

  function tick(now){
    let dt = Math.min((now - lastFrame) / 1000, 0.04); // limit to ~25fps if frame drops
    lastFrame=now;
    if(!gameStarted||gameOver){ requestAnimationFrame(tick); return; }

    // Smooth difficulty scaling, not too aggressive (prevents stalls on low-end)
    monsterSpeed = BASE_MONSTER_SPEED + score * 7;
    heroSpeed    = BASE_HERO_SPEED + score * 3.5;
    spawnRate    = Math.max(8, BASE_SPAWN_RATE - Math.floor(score/5));

    // Movement with dt (with rounding to avoid micro jitter)
    if(window.moveLeft)  heroX = Math.max(0, heroX - heroSpeed * dt);
    if(window.moveRight) heroX = Math.min(W - HERO_SIZE, heroX + heroSpeed * dt);
    if(window.moveUp)    heroY = Math.max(0, heroY - heroSpeed * dt);
    if(window.moveDown)  heroY = Math.min(H - HERO_SIZE, heroY + heroSpeed * dt);

    // Fire rate: up to 8 bullets/sec, avoid memory leak
    if(window.mouseHeld && Math.random() < dt*8)
      bullets.push({x:heroX+15,y:heroY,w:10,h:20});

    // Monster spawn normalized using dt, never too many monsters offscreen
    if(Math.random()*spawnRate < dt*spawnRate && monsters.length < 16)
      monsters.push({x:Math.random()*(W-40),y:0,w:40,h:40});

    for(let i=bullets.length-1; i>=0; i--){
      bullets[i].y -= BULLET_SPEED*dt;
      if(bullets[i].y < -24) bullets.splice(i,1);
    }

    for(let i=monsters.length-1; i>=0; i--){
      monsters[i].y += monsterSpeed*dt;
      if(monsters[i].y > H){
        window.globalGameOver();
        break;
      }
    }

    // Fast collision check, avoids multiple splices per frame
    let removedBullets = new Set(), removedMonsters = new Set();
    bullets.forEach((b,bi)=>{
      monsters.forEach((m,mi)=>{
        if(!removedBullets.has(bi) && !removedMonsters.has(mi) && intersect(b,m)){
          removedBullets.add(bi);
          removedMonsters.add(mi);
          score++;
        }
      });
    });
    bullets = bullets.filter((_,i)=>!removedBullets.has(i));
    monsters = monsters.filter((_,i)=>!removedMonsters.has(i));

    if(score>getHighScore()){
      setHighScore(score);
      showHighScore(score);
    }

    draw();
    requestAnimationFrame(tick);
  }
  reset();
  requestAnimationFrame(tick);
})();

/* --- Controls input --- */
function bind(id, down, up){
  const el=document.getElementById(id);
  el.addEventListener("pointerdown", e=>{e.preventDefault(); down();});
  el.addEventListener("pointerup",   e=>{e.preventDefault(); up();});
  el.addEventListener("pointerleave",e=>{e.preventDefault(); up();});
}
bind("left", ()=>window.moveLeft=true,  ()=>window.moveLeft=false);
bind("right",()=>window.moveRight=true, ()=>window.moveRight=false);
bind("up",   ()=>window.moveUp=true,    ()=>window.moveUp=false);
bind("down", ()=>window.moveDown=true,  ()=>window.moveDown=false);
bind("fireBtn",()=>window.mouseHeld=true,()=>window.mouseHeld=false);

document.getElementById("startBtn").onclick = ()=>{
  document.getElementById("startScreen").style.display="none";
  gameStarted=true; globalReset();
  fitCanvas();
};
document.getElementById("retryBtn").onclick = ()=>{
  document.getElementById("retryScreen").style.display="none";
  gameStarted=true; globalReset();
  fitCanvas();
};
</script>
</body>
</html>
